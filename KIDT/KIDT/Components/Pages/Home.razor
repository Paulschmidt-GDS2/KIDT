@* Ziel: Chat-Seite mit Nachrichtenliste und Eingabebox *@
@page "/"

<div class="chat-container">
    <div class="messages">
        <div class="messages-inner">
            @foreach (var msg in Messages)
            {
                <div class="message-bubble">@msg</div>
            }
        </div>
    </div>

    <div class="chat-input-container">
        <div class="chat-input @(Messages.Count > 0 ? "has-messages" : null)" role="search" aria-label="Chat Eingabe">
            <textarea class="chat-textbox" placeholder="Nachricht eingeben..." aria-label="Chat Nachricht" @bind="InputText" @bind:event="oninput" rows="@rows" cols="@Cols"></textarea>
            <button class="chat-send" title="Senden" aria-label="Nachricht senden" @onclick="SendMessage">Senden</button>
        </div>
    </div>
</div>

@code {
    // Nachrichtenliste
    private List<string> Messages = new();

    // Eingabe: wächst stufenweise pro Zeile
    private const int MaxRows = 19; // ~10cm Höhe
    private const int Cols = 60;    // grobe Zeichenbreite pro Zeile
    private int rows = 1;           // Startzeilen

    private string inputText = string.Empty;
    private string InputText
    {
        get { return inputText; }
        set
        {
            if (value == null) value = string.Empty;
            inputText = value;
            UpdateRows();
        }
    }

    private void UpdateRows()
    {
        var lines = inputText.Split('\n');
        int total = 0;
        foreach (var line in lines)
        {
            int wraps = (int)Math.Ceiling(line.Length / (double)Cols);
            if (wraps < 1) wraps = 1;
            total += wraps;
        }
        rows = Math.Clamp(total, 2, MaxRows);
    }

    private void SendMessage()
    {
        var text = (InputText ?? string.Empty).Trim();
        if (text.Length == 0) return;
        Messages.Add(text);
        InputText = string.Empty;
        rows = 2;
    }
}

<style>
    body { margin: 0; }
    .chat-container { height: 100%; display: flex; flex-direction: column; }

    /* Nachrichtenbereich (mit Scrollbar) */
    .messages { flex: 1; overflow-y: auto; padding: 16px 16px 160px; box-sizing: border-box; display: flex; justify-content: center; scrollbar-color: rgba(255,255,255,0.25) #1a2438; scrollbar-width: thin; }
    .messages::-webkit-scrollbar { width: 8px; height: 8px; }
    .messages::-webkit-scrollbar-track { background: #1a2438; border-radius: 8px; }
    .messages::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.25); border-radius: 8px; border: 2px solid #1a2438; }
    .messages::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.35); }

    /* Innenbereich: gleiche Breite wie Input, rechts ausgerichtet */
    .messages-inner { width: min(800px, calc(100% - 120px)); display: flex; flex-direction: column; align-items: flex-end; gap: 8px; padding: 0.25cm 0 0.25cm 0.25cm; box-sizing: border-box; }

    /* Bubbles sind schmal und passen sich dem Inhalt an */
    .message-bubble { display: inline-block; max-width: min(600px, 90%); background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: #fff; padding: 0.25cm; border-radius: 12px; text-align: left; word-wrap: break-word; overflow-wrap: anywhere; margin: 0; box-sizing: border-box; }

    /* Input-Box klebt unten mittig, Klicks erlaubt */
    .chat-input-container { position: sticky; bottom: 12%; display: flex; justify-content: center; pointer-events: none; }
    .chat-input { pointer-events: auto; display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: #1a2438; border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; width: min(800px, calc(100% - 120px)); box-sizing: border-box; transition: box-shadow 0.2s ease; }
    .chat-input.has-messages { box-shadow: 0 0 24px 6px rgba(0,0,0,0.55); }

    .chat-textbox { flex: 1; min-height: 44px; max-height: 10cm; line-height: 20px; padding: 10px 12px; border-radius: 8px; border: none; background: #202a3f; color: #fff; overflow-y: auto; resize: none; width: 100%; box-sizing: border-box; scrollbar-color: rgba(255,255,255,0.25) rgba(0,0,0,0.25); scrollbar-width: thin; }
    .chat-textbox::-webkit-scrollbar { width: 8px; height: 8px; }
    .chat-textbox::-webkit-scrollbar-track { background: rgba(0,0,0,0.25); border-radius: 8px; }
    .chat-textbox::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.30); border-radius: 8px; border: 2px solid rgba(0,0,0,0.25); }
    .chat-textbox::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.40); }
    .chat-textbox::placeholder { color: #cfd3dc; }

    /* Senden-Button */
    .chat-send { margin-left: auto; padding: 10px 14px; border-radius: 8px; border: none; background: #202a3f; color: #e5eaf3; cursor: pointer; align-self: center; transition: background 0.2s ease, transform 0.05s ease; }
    .chat-send:hover { background: #243047; }
    .chat-send:active { transform: translateY(1px); }
</style>
